{% load static %}

<style>
    #filter-clear {
      display: inline;
      padding-left: 30px;
    }

    .filter-tag {
      background-color: rgb(183, 210, 255);
      border-radius: 3px;
      display: inline-block;
      padding: 0 8px;
    }

    #share-link {
      border: 1px solid rgb(151, 153, 160);
      border-radius: 3px;
      border-bottom-right-radius: 0;
      border-top-right-radius: 0;
      box-shadow: inset 0 1px 2px rgba(0,0,0,.075);
      display: inline-block;
      height: 20px;
      line-height: 1;
      margin-left: 4px;
      padding: 4px 8px;
      padding-bottom: 1px;
    }

    #share-link-copy {
      background-image: linear-gradient(#fcfcfc,#eee);
      border-radius: 3px;
      border-bottom-left-radius: 0;
      border-top-left-radius: 0;
      border: solid rgb(151, 153, 160) 1px;
      line-height: 20px;
      margin-left: -8px;
      padding: 4px 8px 1px 10px;
      position: relative;
      vertical-align: -2px;
    }

    #share-target {
      border-width: 0;
      padding: 0;
      width: 0px;
    }

    #success-message {
      transition: opacity 2.1s;
      -webkit-transition: opacity 2.1s;
    }

    #success-message.fast-in {
      transition: unset;
      -webkit-transition: unset;
    }
</style>

{% if urlFilter != None and urlFilter|length > 0 %}
    {% with endpoint="plr:"|add:view_name %}
    <div class="ibm-margin-bottom-1" style="margin-right: 60px; display: inline-block;">
        <p class="ibm-bold" style="display: inline; padding-right: 5px;">
          URL filters applied:
        </p>
        {% for filter in urlFilter %}
            <p class="filter-tag">{{ filter }}</p>
        {% endfor %}
            <form id="filter-clear" action="{% url endpoint %}" method="POST">
                {% csrf_token %}
                <button class="ibm-btn-pri ibm-btn-small ibm-btn-green-50 ibm-margin-bottom-2">Clear filters</button>
            </form>
    </div>
    <div class="ibm-margin-bottom-1" style="display: inline-block;">
        Link:
        <a href="{{ shareLink }}" id="share-link">{{ shareLink }}</a>
        <input id="share-target" value="{{ shareLink }}">
        <button id="share-link-copy" class="btn" data-clipboard-target="#share-target">
            <img src="{% static 'report/clippy.png' %}" alt="Copy to clipboard" height='15px'>
        </button>
        <span id="success-message"></span>
    </div>
    <script src="{% static 'report/widgets/clipboard.min.js' %}"></script>
    <script>
        const btn = document.getElementById('share-link-copy');
        const clipboard = new ClipboardJS(btn);

        clipboard.on('success', () => {
            const successMesssageBox = document.getElementById('success-message');
            const successColor = 'rgb(110, 201, 135)';

            document.getElementById('share-link').style.borderColor = successColor;
            document.getElementById('share-link-copy').style.backgroundImage =
                `linear-gradient(${successColor}, rgb(41, 153, 71))`;
            successMesssageBox.classList.add('fast-in');
            successMesssageBox.style.opacity = 1;
            successMesssageBox.innerText = 'Copied.'
            setTimeout(() => {
              successMesssageBox.classList.remove('fast-in');
              successMesssageBox.style.opacity = 0;
            }, 500);
        });
    </script>
    {% endwith %}
{% endif %}
