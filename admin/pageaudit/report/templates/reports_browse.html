{% extends "page_template.html" %}

{% load beautify %}
{% load static %}


{% block pageTitle %} Report cards {% endblock  %}


{% block menuBrowsereportsClass %}pl-highlight{% endblock %}
  
        
{% block extraFiles %}
    <link href="{% static 'report/css/select2.min.css' %}" rel="stylesheet"/>
    <script src="{% static 'report/js/select2.min.js' %}"></script>
    <script src="{% static 'report/js/compare.js' %}"></script>
        
    <script>
        
        (function ($) {
            
            var $sortForm, $loadmoreContainer, $cardContainer, pageNum = 1;
            
            
            function setupLoadMore () {
                $loadmoreContainer.find("button")[0].addEventListener("click", loadMoreCards);
            }
            
            
            function loadMoreCards () {
                $.ajax({
                    url: "{% url 'plr:api_home_items' %}?page=" + (pageNum + 1),
                    dataType: "json",
                    data: $sortform.serialize(),
                    success: function (data) {
                        $cardContainer.append(data.resultsHtml);
                        
                        PL.compare.preselectCheckbox($cardContainer.find("input:checkbox"));
                        
                        if (data.hasNextPage) {
                            pageNum = (data.pageNum + 1);
                        }
                        else {
                            $loadmoreContainer.remove();
                        }
                    }
               });
            }
            
            
            $(function () {
                $cardContainer = $("#pl-cards-container");
                $loadmoreContainer = $("#pl-loadmore");
                $sortForm = $("#pl-sortform");
                
                if ($loadmoreContainer[0]) {
                    setupLoadMore();
                }
                
                // Setup checkboxes on this page to add/remove items in the compare tray.
                PL.compare.setupCompareCheckboxes($("#pl-cards-container"));
                PL.compare.preselectCheckbox($("input:checkbox"));
                
                // Setup select2 widgets.
                $("select").select2({
                    minimumResultsForSearch: 8
                });
            });
            
        })(jQuery);
                
    </script>
    
{% endblock %}


{% block content %}

	<div class="{{ templateHelpers.classes.grid }} mt4">
        <form id="pl-sortform" aria-label="Sort data listing" action="" method="get">
            <div class="mb3 dib mr2">
                <p class="b mt0">Sort:</p>
                <select name="sortby" aria-label="Select a field">
                    <option value="url" {% if sortby == 'url' %}selected="selected"{% endif %}>URL</option>
                    <option value="date" {% if sortby == 'date' %}selected="selected"{% endif %}>Last test date</option>
                    <option value="a11yscore" {% if sortby == 'a11yscore' %}selected="selected"{% endif %}>Accessibility score</option>
                    <option value="perfscore" {% if sortby == 'perfscore' %}selected="selected"{% endif %}>Performance score</option>
                    <option value="seoscore" {% if sortby == 'seoscore' %}selected="selected"{% endif %}>SEO score</option>
                </select>
            </div>
            
            <div class="mb3 dib mr4">
                <select name="sortorder" aria-label="Select an order">
                    <option value="asc" {% if sortorder == 'asc' %}selected="selected"{% endif %}>Ascending</option>
                    <option value="desc" {% if sortorder == 'desc' %}selected="selected"{% endif %}>Descending</option>
                </select>
            </div>
            
        
            <div class="mb3 dib mr4">
                <p class="b mt0">Show:</p>
                <select name="viewdata" aria-label="Select an order">
                    <option value="perfscore" {% if viewdata == 'perfscore' %}selected="selected"{% endif %}>Performance score</option>
                    <option value="a11yscore" {% if viewdata == 'a11yscore' %}selected="selected"{% endif %}>Accessibility score</option>
                    <option value="seoscore" {% if viewdata == 'seoscore' %}selected="selected"{% endif %}>SEO score</option>
                </select>
            </div>
                    
            <div class="mb3 dib mr3">
                <button type="submit" class="{{ templateHelpers.classes.smallButton }} {{ templateHelpers.classes.bluePriButton }} relative" style="top:2px;">Apply</button>
            </div>
               
        </form>
	</div>
	
	
	<div id="pl-cards-container" class="{{ templateHelpers.classes.grid }} mt4 flex flex-wrap center">
        {% for url in urls %}
            {% include "browse_item.html" with url=url %}
        {% endfor %}	  
	</div>
	
	
    {% if hasNextPage %}
    	<div id="pl-loadmore" class="{{ templateHelpers.classes.grid }} tc mv5">
        	<button type="button" class="{{ templateHelpers.classes.button }} {{ templateHelpers.classes.bluePriButton }}">Load more</button>
    	</div>
    {% endif %}	
	
	{% include "compare_tray.html" %}
	
	
{% endblock %}
